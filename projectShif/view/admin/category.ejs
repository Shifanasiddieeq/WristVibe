<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Category Management</title>
    <link rel="stylesheet" href="/style/admin/category.css">
</head>
<body>
    <div class="admin-dashboard">
        <aside class="sidebar">
            <h2>Wrist Vibe</h2>
            <nav>
                <ul>
                    <li><a href="/admin/dashboard">Dashboard</a></li>
                    <li><a href="/admin/products">Products</a></li>
                    <li><a href="/admin/users">Users</a></li>
                    <li><a href="/admin/categories" class="active">Category</a></li>
                </ul>
            </nav>
        </aside>
        <main class="content">
            <header>
                <h1>Category</h1>
                <button class="add-btn" onclick="document.getElementById('addModal').style.display='flex'">Add</button>
            </header>
            <section>

                    <% if (error) { %>
                        <div class="error-message" style="color: red; margin-bottom: 10px;">
                            <%= error %>
                        </div>
                    <% } %>
                    <% if (success) { %>
                        <div class="success-message" style="color: green; margin-bottom: 10px;">
                            <%= success %>
                        </div>
                    <% } %>

                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>NAME</th>
                            <th>DESCRIPTION</th>
                            <th>ACTION</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% categories.forEach((category, index) => { %>
                            <tr>
                                <td><%= index + 1 %></td>
                                <td><%= category.name %></td>
                                <td><%= category.description %></td>
                                <td>
                                    <button class="edit-btn" onclick="editCategory('<%= category._id %>', '<%= category.name %>', '<%= category.description %>')">Edit</button>
                                    <form action="/admin/categories/<%= category._id %>/toggle-status" method="POST" style="display:inline;">
                                        <% if (category.isListed) { %>
                                            <button class="status-btn unlist" type="submit">Unlist</button>
                                        <% } else { %>
                                            <button class="status-btn list" type="submit">List</button>
                                        <% } %>
                                    </form>
                                </td>
                            </tr>
                        <% }) %>
                    </tbody>
                </table>
            </section>
        </main>
    </div>

    <!-- Add Modal -->
    <div id="addModal" class="modal">
        <div class="modal-content">
            <h2>Add Category</h2>
            <form action="/admin/categories" method="POST" onsubmit="return validateForm()">
                <label for="name">Name:</label>
                <input type="text" id="name" name="name" >
                <label for="description">Description:</label>
                <textarea id="description" name="description"></textarea>
                <button type="submit" class="save-btn">Add</button>
                <button type="button" class="cancel-btn" onclick="document.getElementById('addModal').style.display='none'">Cancel</button>
            </form>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="modal" onsubmit="return validateEditForm()">
        <div class="modal-content">
            <h2>Edit Category</h2>
            <form id="editForm" action="/admin/categories" method="POST">
                <label for="editName">Name:</label>
                <input type="text" id="editName" name="name" >
                <label for="editDescription">Description:</label>
                <textarea id="editDescription" name="description"></textarea>
                <button type="submit" class="save-btn">Save</button>
                <button type="button" class="cancel-btn" onclick="closeEditModal()">Cancel</button>
            </form>
        </div>
    </div>

    <script>
        function validateForm() {
    const name = document.getElementById('name').value.trim();
    const description = document.getElementById('description').value.trim();

    if (!name || !description) {
        alert('Name and Description cannot be empty.');
        return false;
    }
    return true;
   }

   function validateEditForm() {
        const name = document.getElementById('editName').value.trim();
        const description = document.getElementById('editDescription').value.trim();
        if (!name || !description) {
        alert('Name and Description cannot be empty.');
        return false;
    }
    return true;
      
    }


        function editCategory(id, name, description) {
            document.getElementById('editModal').style.display = 'flex';
            document.getElementById('editForm').action = `/admin/categories/${id}/edit`;
            document.getElementById('editName').value = name;
            document.getElementById('editDescription').value = description;
        }

        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
        }
    </script>
</body>
</html>
